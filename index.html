<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    body { 
      margin: 0; 
      font-family: 'Courier New', monospace; 
      background: #000; 
      color: #0f0; 
      font-size: 1.8vw; 
      overflow: hidden; 
    }
    .header { 
      text-align: center; 
      font-size: 3vw; 
      margin: 10px; 
      color: #ff0; 
    }
    .section { margin: 15px; }
    .section h2 { 
      color: #ff0; 
      font-size: 2.2vw; 
      margin-bottom: 8px; 
    }
    table { width: 100%; border-collapse: collapse; }
    th, td { 
      padding: 6px; 
      text-align: center; 
      border-bottom: 1px solid #333; 
      font-size: 1.6vw; 
    }
    th { background: #001a00; color: #0f0; }
    .active { color: #00ff00; font-weight: bold; }
    .scheduled { color: #ffff00; }
    .delayed { color: #ff6600; animation: blink 1s infinite; }
    .cancelled { color: #ff0000; animation: blink 0.5s infinite; }
    @keyframes blink { 50% { opacity: 0.4; } }
  </style>
</head>
<body>
  <div class="header">üõ´ –®–ï–†–ï–ú–ï–¢–¨–ï–í–û (SVO) üõ¨ <span id="localTime" style="font-size: 2vw; color: #0ff;"></span></div>
  
  <div class="section">
    <h2>üì§ –í–´–õ–ï–¢–´ (5)</h2>
    <table id="departures">
      <thead><tr><th>–†–µ–π—Å</th><th>–ö—É–¥–∞</th><th>–í—Ä–µ–º—è</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
  
  <div class="section">
    <h2>üì• –ü–†–ò–õ–Å–¢–´ (5)</h2>
    <table id="arrivals">
      <thead><tr><th>–†–µ–π—Å</th><th>–û—Ç–∫—É–¥–∞</th><th>–í—Ä–µ–º—è</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const API_KEY = 'a01c8c93edfa06bc5d12e15816ad3035';
    
    // –ß–∞—Å—ã –ú–°–ö
    function updateClock() {
      const now = new Date().toLocaleString('ru-RU', {timeZone: 'Europe/Moscow', 
        hour: '2-digit', minute: '2-digit'});
      document.getElementById('localTime').textContent = `–ú–°–ö ${now}`;
    }
    updateClock();
    setInterval(updateClock, 1000);
    
    async function loadDepartures() {
      try {
        // –ñ–ò–í–´–ï —Ä–µ–π—Å—ã –±–ª–∏–∂–∞–π—à–∏–µ 4 —á–∞—Å–∞
        const res = await fetch(`https://api.aviationstack.com/v1/flights?dep_iata=SVO&limit=20&flight_status=all&access_key=${API_KEY}`);
        const data = await res.json();
        updateTable('departures', data.data, 'departure');
      } catch(e) { console.error('–í—ã–ª–µ—Ç—ã:', e); }
    }
    
    async function loadArrivals() {
      try {
        // –ñ–ò–í–´–ï —Ä–µ–π—Å—ã –±–ª–∏–∂–∞–π—à–∏–µ 4 —á–∞—Å–∞  
        const res = await fetch(`https://api.aviationstack.com/v1/flights?arr_iata=SVO&limit=20&flight_status=all&access_key=${API_KEY}`);
        const data = await res.json();
        updateTable('arrivals', data.data, 'arrival');
      } catch(e) { console.error('–ü—Ä–∏–ª—ë—Ç—ã:', e); }
    }
    
    function updateTable(tableId, flights, type) {
      const table = document.getElementById(tableId);
      const tbody = table.querySelector('tbody');
      tbody.innerHTML = '';
      
      // –§–ò–õ–¨–¢–†: —Ç–æ–ª—å–∫–æ –±–ª–∏–∂–∞–π—à–∏–µ 4 —á–∞—Å–∞ + –¢–û–õ–¨–ö–û 5 —Ä–µ–π—Å–æ–≤
      const now = new Date();
      const filteredFlights = flights
        .filter(flight => {
          const flightTime = new Date(flight[type]?.scheduled);
          const diff = (flightTime - now) / (1000 * 60 * 60); // —á–∞—Å—ã
          return diff > -1 && diff < 4; // ¬±1 —á–∞—Å –æ—Ç —Å–µ–π—á–∞—Å
        })
        .slice(0, 5); // –¢–û–õ–¨–ö–û 5!
      
      filteredFlights.forEach(flight => {
        const status = (flight.flight_status || 'scheduled').toLowerCase();
        const statusClass = status.includes('active') ? 'active' : 
                           status.includes('delay') || status.includes('late') ? 'delayed' : 
                           status.includes('cancel') ? 'cancelled' : 'scheduled';
        
        // –í–†–ï–ú–Ø –ú–°–ö
        const flightTime = new Date(flight[type]?.scheduled).toLocaleTimeString('ru-RU', {
          timeZone: 'Europe/Moscow',
          hour: '2-digit', 
          minute: '2-digit'
        });
        
        const city = (type === 'departure' ? flight.arrival?.airport : flight.departure?.airport || 'N/A')
          .replace(' International Airport', '').replace(' Airport', '').replace(' Intl', '');
        const flightNum = flight.flight?.iata || flight.flight?.icao?.slice(-4) || 'N/A';
        
        const row = tbody.insertRow();
        row.innerHTML = `
          <td>${flightNum}</td>
          <td>${city}</td>
          <td>${flightTime}</td>
          <td class="${statusClass}">${status.toUpperCase()}</td>
        `;
      });
    }
    
    // –ó–∞–ø—É—Å–∫ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫
    loadDepartures();
    loadArrivals();
    setInterval(() => { loadDepartures(); loadArrivals(); }, 60000);
  </script>
</body>
</html>
