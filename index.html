<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–±–ª–æ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞ BHX - Live</title>
    <style>
        /* [–ü—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π] */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: #0a0a0a;
            color: #00ff00;
            font-family: 'Orbitron', monospace;
            height: 100vh;
            overflow: hidden;
        }
        
        .airport-board {
            width: 100%;
            height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            background: linear-gradient(180deg, #000 0%, #001100 50%, #000 100%);
        }
        
        .status-bar {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #00ff00;
            font-size: 0.9rem;
            z-index: 1000;
        }
        
        .status-bar.loading { color: #ffaa00; }
        .status-bar.error { color: #ff4444; }
        .status-bar.success { color: #00ff00; }
        
        .board-header {
            text-align: center;
            margin-bottom: 20px;
            font-size: clamp(1.5rem, 4vw, 3rem);
            font-weight: 900;
            letter-spacing: 8px;
            text-shadow: 0 0 20px #00ff00;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            to { text-shadow: 0 0 30px #00ff00, 0 0 60px #00ff00; }
        }
        
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –∫–∞–∫ —Ä–∞–Ω—å—à–µ */
        .flights-table {
            flex: 1;
            border-collapse: collapse;
            width: 100%;
            background: rgba(0,20,0,0.9);
            border: 3px solid #00ff00;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0,255,0,0.4);
            font-family: 'Orbitron', monospace;
        }
        
        .flights-table th {
            background: linear-gradient(90deg, #003300, #006600);
            padding: 15px 10px;
            text-align: left;
            font-weight: 900;
            font-size: 1rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            border-bottom: 2px solid #00ff00;
        }
        
        .flights-table td {
            padding: 18px 10px;
            font-size: 1.1rem;
            font-weight: 700;
            border-bottom: 1px solid rgba(0,255,0,0.3);
        }
        
        .no-flights {
            text-align: center;
            padding: 40px;
            color: #ffaa00;
            font-size: 1.2rem;
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <div class="status-bar" id="status">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Å–æ–≤...</div>
    
    <div class="airport-board">
        <div class="board-header">üõ´ Birmingham Airport (BHX) - Live</div>
        
        <table class="flights-table" id="flightsTable">
            <thead>
                <tr>
                    <th>–í—Ä–µ–º—è</th>
                    <th>–†–µ–π—Å</th>
                    <th>–ê–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏—è</th>
                    <th>–°–∞–º–æ–ª–µ—Ç</th>
                    <th>–ì–æ—Ä–æ–¥</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                </tr>
            </thead>
            <tbody id="flightsBody">
                <tr><td colspan="6" class="no-flights">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Å–æ–≤...</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        const API_KEY = 'b678f9df-013d-46f0-b536-d5a8be6a3428';
        const AIRPORT_IATA = 'BHX';
        const statusEl = document.getElementById('status');
        const flightsBody = document.getElementById('flightsBody');
        
        // –¢–µ—Å—Ç–æ–≤—ã–π endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API
        async function testApi() {
            statusEl.textContent = '–¢–µ—Å—Ç API...';
            statusEl.className = 'status-bar loading';
            
            try {
                const response = await fetch(`https://airlabs.co/api/v9/ping?api_key=${API_KEY}`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                if (data.response_code === 200) {
                    statusEl.textContent = 'API —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úì';
                    statusEl.className = 'status-bar success';
                    loadFlights();
                } else {
                    throw new Error(data.error?.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
            } catch (error) {
                statusEl.textContent = `API –æ—à–∏–±–∫–∞: ${error.message}`;
                statusEl.className = 'status-bar error';
                loadDemoFlights();
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–µ–π—Å–æ–≤ –≤—ã–ª–µ—Ç–æ–≤
        async function loadFlights() {
            statusEl.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Å–æ–≤ BHX...';
            statusEl.className = 'status-bar loading';
            
            try {
                // –ü–æ–ø—Ä–æ–±—É–µ–º departures (–≤—ã–ª–µ—Ç—ã)
                const response = await fetch(
                    `https://airlabs.co/api/v9/departures?airport_code=${AIRPORT_IATA}&api_key=${API_KEY}&duration=2`,
                    { method: 'GET' }
                );
                
                const data = await response.json();
                
                if (data.response_code === 200 && data.response.length > 0) {
                    displayFlights(data.response);
                    statusEl.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.response.length} —Ä–µ–π—Å–æ–≤ ‚úì`;
                    statusEl.className = 'status-bar success';
                } else {
                    // –ï—Å–ª–∏ –Ω–µ—Ç –≤—ã–ª–µ—Ç–æ–≤, –ø–æ–ø—Ä–æ–±—É–µ–º –ø—Ä–∏–ª–µ—Ç—ã
                    loadArrivals();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                statusEl.textContent = 'CORS –æ—à–∏–±–∫–∞ - –∏—Å–ø–æ–ª—å–∑—É—é –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ';
                statusEl.className = 'status-bar error';
                loadDemoFlights();
            }
        }
        
        // –ü—Ä–∏–ª–µ—Ç—ã –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
        async function loadArrivals() {
            try {
                const response = await fetch(
                    `https://airlabs.co/api/v9/arrivals?airport_code=${AIRPORT_IATA}&api_key=${API_KEY}&duration=2`,
                    { method: 'GET' }
                );
                const data = await response.json();
                if (data.response_code === 200 && data.response.length > 0) {
                    displayFlights(data.response);
                }
            } catch (error) {
                loadDemoFlights();
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–π—Å–æ–≤
        function displayFlights(flights) {
            flightsBody.innerHTML = '';
            
            flights.slice(0, 15).forEach(flight => { // –ü–µ—Ä–≤—ã–µ 15 —Ä–µ–π—Å–æ–≤
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatTime(flight.dep_time || flight.arr_time)}</td>
                    <td><strong>${flight.flight_iata || flight.flight_icao}</strong></td>
                    <td>${flight.airline_name || flight.airline_iata}</td>
                    <td>${flight.aircraft_icao || '‚Äî'}</td>
                    <td>${flight.arr_iata || flight.dep_iata} ${flight.city || ''}</td>
                    <td class="status on-time">${flight.status || '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω'}</td>
                `;
                flightsBody.appendChild(row);
            });
            
            if (flights.length === 0) {
                flightsBody.innerHTML = '<tr><td colspan="6" class="no-flights">–†–µ–π—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>';
            }
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function formatTime(timestamp) {
            if (!timestamp) return '‚Äî';
            const date = new Date(timestamp * 1000);
            return date.toLocaleTimeString('ru-RU', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }
        
        // –î–µ–º–æ —Ä–µ–π—Å—ã –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º —Å API
        function loadDemoFlights() {
            const demoFlights = [
                { time: '14:35', flight: 'BA1234', airline: 'British Airways', aircraft: 'A320', dest: 'LHR', status: '–ü–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é' },
                { time: '14:45', flight: 'FR5678', airline: 'Ryanair', aircraft: 'B738', dest: 'DUB', status: '–ó–∞–¥–µ—Ä–∂–∫–∞ +25' },
                { time: '15:00', flight: 'U28590', airline: 'EasyJet', aircraft: 'A319', dest: 'AMS', status: '–ü–æ—Å–∞–¥–∫–∞' }
            ];
            
            displayFlights(demoFlights.map(f => ({ dep_time: Date.now()/1000, flight_iata: f.flight, airline_name: f.airline, aircraft_icao: f.aircraft, arr_iata: f.dest, status: f.status })));
        }
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            if (statusEl.className.includes('success')) {
                loadFlights();
            }
        }, 30000);
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', testApi);
    </script>
</body>
</html>
