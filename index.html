<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Courier New', 'OCR A Std', monospace; 
      background: linear-gradient(180deg, #000 0%, #001122 100%); 
      color: #00ff00; 
      font-size: 2.2vw; 
      height: 100vh; 
      overflow: hidden;
    }
    .header { 
      background: linear-gradient(90deg, #003300, #006600, #003300); 
      text-align: center; 
      padding: 15px; 
      font-size: 3.5vw; 
      color: #ffff00; 
      text-shadow: 0 0 10px #ffff00;
      border-bottom: 3px solid #00ff00;
    }
    .time { font-size: 2.5vw; color: #00ffff; font-weight: bold; }
    .section { 
      padding: 20px; 
      height: 48%; 
      display: flex; 
      flex-direction: column;
    }
    .section h2 { 
      color: #ffff00; 
      font-size: 2.8vw; 
      margin-bottom: 10px; 
      text-align: center;
      text-shadow: 0 0 5px #ffff00;
    }
    table { 
      flex: 1; 
      width: 100%; 
      border-collapse: collapse; 
      background: rgba(0,20,0,0.8);
      box-shadow: 0 0 20px rgba(0,255,0,0.3);
    }
    th { 
      background: linear-gradient(90deg, #002200, #004400); 
      color: #00ff00; 
      padding: 8px; 
      text-align: center; 
      font-size: 1.8vw;
      border-bottom: 2px solid #00ff00;
      text-shadow: 0 0 3px #00ff00;
    }
    td { 
      padding: 8px; 
      text-align: center; 
      border-bottom: 1px solid #003300; 
      font-size: 1.9vw;
    }
    .active { color: #00ff00; text-shadow: 0 0 5px #00ff00; }
    .scheduled { color: #ffff00; }
    .delayed { color: #ff6600; animation: blink 1s infinite; text-shadow: 0 0 5px #ff6600; }
    .cancelled { color: #ff0000; animation: blink 0.6s infinite; text-shadow: 0 0 8px #ff0000; }
    @keyframes blink { 0%,50% { opacity: 1; } 51%,100% { opacity: 0.4; } }
    .terminal { background: rgba(0,255,0,0.2); padding: 2px 6px; border-radius: 3px; font-size: 1.6vw; }
  </style>
</head>
<body>
  <div class="header">
    üõ´ –ê–≠–†–û–ü–û–†–¢ –®–ï–†–ï–ú–ï–¢–¨–ï–í–û (SVO) üõ¨ 
    <div class="time" id="localTime">–ú–°–ö 15:31</div>
  </div>
  
  <div class="section">
    <h2>üì§ –í–´–õ–ï–¢–´ (–±–ª–∏–∂–∞–π—à–∏–π —á–∞—Å)</h2>
    <table id="departures">
      <thead><tr><th>–†–µ–π—Å</th><th>–ö—É–¥–∞</th><th>–í—Ä–µ–º—è</th><th>–°—Ç–∞—Ç—É—Å</th><th>–¢–µ—Ä–º–∏–Ω–∞–ª</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
  
  <div class="section">
    <h2>üì• –ü–†–ò–õ–Å–¢–´ (–±–ª–∏–∂–∞–π—à–∏–π —á–∞—Å)</h2>
    <table id="arrivals">
      <thead><tr><th>–†–µ–π—Å</th><th>–û—Ç–∫—É–¥–∞</th><th>–í—Ä–µ–º—è</th><th>–°—Ç–∞—Ç—É—Å</th><th>–¢–µ—Ä–º–∏–Ω–∞–ª</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const API_KEY = 'a01c8c93edfa06bc5d12e15816ad3035';
    
    // –ß–∞—Å—ã –ú–°–ö
    function updateClock() {
      const now = new Date().toLocaleString('ru-RU', {timeZone: 'Europe/Moscow', 
        hour: '2-digit', minute: '2-digit'});
      document.getElementById('localTime').textContent = `–ú–°–ö ${now}`;
    }
    updateClock();
    setInterval(updateClock, 1000);
    
    async function loadDepartures() {
      try {
        const res = await fetch(`https://api.aviationstack.com/v1/flights?dep_iata=SVO&limit=30&access_key=${API_KEY}`);
        const data = await res.json();
        updateTable('departures', data.data, 'departure');
      } catch(e) { console.error('–í—ã–ª–µ—Ç—ã:', e); }
    }
    
    async function loadArrivals() {
      try {
        const res = await fetch(`https://api.aviationstack.com/v1/flights?arr_iata=SVO&limit=30&access_key=${API_KEY}`);
        const data = await res.json();
        updateTable('arrivals', data.data, 'arrival');
      } catch(e) { console.error('–ü—Ä–∏–ª—ë—Ç—ã:', e); }
    }
    
    function updateTable(tableId, flights, type) {
      const table = document.getElementById(tableId);
      const tbody = table.querySelector('tbody');
      tbody.innerHTML = '';
      
      const now = new Date();
      
      // üö® –§–ò–õ–¨–¢–†: –¢–û–õ–¨–ö–û –±–ª–∏–∂–∞–π—à–∏–π —á–∞—Å (¬±30 –º–∏–Ω)
      const nearFlights = flights
        .filter(flight => {
          const scheduledTime = new Date(flight[type]?.scheduled);
          const diffMinutes = (scheduledTime - now) / (1000 * 60);
          return diffMinutes >= -30 && diffMinutes <= 60; // -30–º +60–º –æ—Ç —Å–µ–π—á–∞—Å
        })
        .sort((a, b) => new Date(a[type]?.scheduled) - new Date(b[type]?.scheduled))
        .slice(0, 5);
      
      // –ï—Å–ª–∏ –Ω–µ—Ç —Ä–µ–π—Å–æ–≤ –±–ª–∏–∂–∞–π—à–∏–π —á–∞—Å ‚Äî –ø–µ—Ä–≤—ã–µ 5
      const displayFlights = nearFlights.length ? nearFlights : flights.slice(0, 5);
      
      displayFlights.forEach(flight => {
        const status = (flight.flight_status || 'scheduled').toLowerCase();
        const statusClass = status.includes('active') ? 'active' : 
                           status.includes('delay') || status.includes('late') ? 'delayed' : 
                           status.includes('cancel') ? 'cancelled' : 'scheduled';
        
        const scheduledTime = flight[type]?.scheduled;
        const flightTime = scheduledTime ? new Date(scheduledTime).toLocaleTimeString('ru-RU', {
          timeZone: 'Europe/Moscow', hour: '2-digit', minute: '2-digit'
        }) : '‚Äî';
        
        const city = type === 'departure' ? 
          (flight.arrival?.airport || '').replace(' International Airport', '').replace(' Airport', '') :
          (flight.departure?.airport || '').replace('Sheremetyevo International', '');
          
        const flightNum = flight.flight?.iata || flight.flight?.icao?.slice(-4) || 'N/A';
        const terminal = flight[type]?.terminal || '?';
        
        const row = tbody.insertRow();
        row.innerHTML = `
          <td>${flightNum}</td>
          <td>${city}</td>
          <td>${flightTime}</td>
          <td class="${statusClass}">${status.toUpperCase()}</td>
          <td class="terminal">${terminal}</td>
        `;
      });
    }
    
    // –ó–∞–ø—É—Å–∫ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
    loadDepartures();
    loadArrivals();
    setInterval(() => { loadDepartures(); loadArrivals(); }, 120000);
  </script>
</body>
</html>
